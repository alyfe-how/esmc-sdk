# ESMC 4 - REFERENCE (AEGIS Component Router)
## AEGIS Module Lazy-Loading & ECHO/SEED Protocols

**Version:** 4 (Major Version Bump - Clean Slate Branding)
**Purpose:** Route AEGIS operations ‚Üí Lazy-load modular components
**Token Budget:** ~1,000 tokens (restored SEED execution blocks from 3.67.0)
**Loads:** When user types "echo" or "seed" keywords (lazy-loaded via BOOTSTRAP)

**‚ö†Ô∏è IMPORTANT: This manifest should ONLY be loaded via 8e80df94.md routing**
- If you're reading this directly (without loading 8e80df94.md first) = PROTOCOL VIOLATION
- Correct flow: User request ‚Üí 8e80df94.md ‚Üí 48c49efe.md ‚Üí AEGIS Component Router
- BOOTSTRAP handles: routing, tier detection, version checks, manifest loading

---

## ‚ö° EXECUTION PROTOCOL: AEGIS COMPONENT ROUTER

**Philosophy:** Detect operation ‚Üí Route ‚Üí Load ONLY the needed module (BOOTSTRAP pattern applied to AEGIS)

---

### **STEP 1: Detect AEGIS Operation Type**

**Check user prompt for keywords (case-insensitive, word boundary):**

**Precedence 1 (Memory Operations - Highest Priority):**
- `"seed"` ‚Üí OPERATION = seed
- `"echo"` ‚Üí OPERATION = echo

**Precedence 2 (Document Operations):**
- `"write document"` OR `"write brief"` OR `"create document"` ‚Üí OPERATION = write
- `"changelog"` OR `"CL tag"` OR `"insert CL"` ‚Üí OPERATION = cl

**Precedence 3 (Maintenance Operations):**
- `"garbage collect"` OR `"clean memory"` OR `"gc memory"` ‚Üí OPERATION = gc
- `"audit"` OR `"execution log"` ‚Üí OPERATION = audit

---

### **STEP 2: Log Routing Decision (MANDATORY)**

**Display ONE of these lines based on keyword detection:**

- If OPERATION = seed: `"üß† AEGIS: 'seed' detected ‚Üí Executing seed-session.js"`
- If OPERATION = echo: `"üì∏ AEGIS: 'echo' detected ‚Üí DEPRECATED (use seed workflow)"`
- If OPERATION = write: `"üìù AEGIS: 'write' detected ‚Üí Loading aegis-write.js"`
- If OPERATION = cl: `"üìã AEGIS: 'changelog' detected ‚Üí Executing CL protocol"`
- If OPERATION = gc: `"üóëÔ∏è AEGIS: 'gc' detected ‚Üí Executing GC protocol"`
- If OPERATION = audit: `"üìä AEGIS: 'audit' detected ‚Üí Loading aegis-audit.js"`

**This log is MANDATORY. User needs visible confirmation of routing decision.**

---

### **STEP 3: Execute AEGIS Component**

**Based on OPERATION from STEP 1:**

---

#### **If OPERATION = seed:**

**‚ö†Ô∏è EXECUTION COMMAND (Use Bash tool for Step 3 only):**
```bash
node ".claude/ESMC Complete/core/seed-session.js"
```

**üÜï ESMC 3.98.1: Compressed Seed Protocol (Token-Optimized)**

**Step 1: Analyze conversation** (Extract compact outline - no verbose prose)
**Step 2: Write session file** (Compact JSON to .claude/memory/sessions/)
**Step 3: Execute seed** (Bash tool with EXACT path above)
**Step 4 (Optional): Delegate verbose summary** (ChatGPT API or Sonnet fallback)

**Token Optimization:**
- Old protocol: 400 OUTPUT tokens (verbose summary in Claude response)
- New protocol: 100 OUTPUT tokens (compact outline) + 10 tokens (path display)
- Verbose summary: 0 Claude tokens (delegated to API) or deferred (Sonnet fallback)
- **Savings: ~290 tokens per seed operation (73% reduction)**

**What seed-session.js does:**
   - Automatically finds the most recent session file in .claude/memory/sessions/
   - Seeds it to AEGIS memory
   - Updates .memory-recent.json
   - **Produces full AEGIS output** (badges, stats, confirmation)
   - Token cost: ~500 tokens (vs 10,102 tokens direct read) = 95% savings

**Execute SEED Protocol (Steps 1-3 in detail):**

   **a) Analyze current conversation** - Extract intelligence from conversation history:
   - Summary of work completed
   - Key learnings and decisions
   - Code patterns discovered
   - Environment configurations
   - User preferences and corrections
   - Pending tasks and next steps

   **b) Build sessionData object** using this JSON schema:
   ```json
   {
     "session_id": "YYYY-MM-DD-{topic-slug}",
     "date": "YYYY-MM-DD",
     "project": "Project Name (include version here if needed)",
     "summary": "Brief overview",
     "keywords": ["key", "terms", "used"],
     "key_learnings": [
       {
         "topic": "Topic name",
         "details": "What was learned",
         "context": "Why it matters",
         "files": ["affected/files.ts"]
       }
     ],
     "code_patterns": [
       {
         "pattern": "Pattern name",
         "implementation": "How it works",
         "file": "path/to/file.ts"
       }
     ],
     "environment_setup": {
       "service": {
         "config": "values"
       }
     },
     "decisions": [
       {
         "decision": "What was decided",
         "reason": "Why",
         "impact": "Consequences"
       }
     ],
     "pending_tasks": [],
     "next_steps": []
   }
   ```

   **‚ö†Ô∏è NAMING CONVENTION (ESMC 3.25.1):**
   - ‚úÖ **DO**: Use semantic topic slugs: `2025-10-27-athena-oracle-integration.json`
   - ‚ùå **DON'T**: Include version numbers in filename: `2025-10-27-esmc-3-25-oracle.json`
   - **Rationale**: Version numbers create period conflicts (e.g., "esmc-3.25" contains
     periods which trigger sanitization, causing filename mismatch ‚Üí duplication)
   - **Where versions go**: Use `project` field ("ESMC 3.25 - Feature Name") and
     `keywords` array (["esmc-3.25", ...]) for version tracking
   - **Benefit**: Same topic = same filename = AEGIS naturally appends instead of duplicating

   **c) Write session file** - Use Write tool:
   ```
   Path: .claude/memory/sessions/{session_id}.json
   Filename format: YYYY-MM-DD-{topic-slug}.json
   Content: Complete sessionData JSON from step (b)
   ```

   **d) Invoke AEGIS smartSeed** - Execute seed-session.js (auto-finds most recent file):
   ```bash
   node ".claude/ESMC Complete/core/seed-session.js"
   ```

   **‚ö†Ô∏è CRITICAL: seed-session.js automatically finds the most recent session file**
   - **No parameters needed** - it finds YYYY-MM-DD-*.json files automatically
   - Sorts by date (most recent first)
   - Seeds the newest session

   **After AEGIS processes the file:**
   - AEGIS will merge intelligence into memory registry
   - Auto-update .memory-recent.json (FIFO, rank #1)
   - Sync topic index for ATLAS retrieval
   - Rebuild project map (incremental)

   **e) Confirm capture** - Display AEGIS smartSeed results:
   - "‚úÖ Session seeded successfully!"
   - Show changes: +N learnings, +M patterns
   - Confirm ATLAS memory-recent.json updated

**STOP.** SEED is a terminal operation.

---

#### **If OPERATION = echo:**

**‚ö†Ô∏è ECHO DEPRECATED (ESMC 3.80+):** Use seed workflow instead.

**Legacy Support (for ESMC < 3.80):**

Use Bash tool:
```bash
node ".claude/ESMC-Chaos/components/cb06ef9b.js" increment
```

**STOP.** ECHO is a terminal operation.

**üìã Legacy ECHO Documentation:** `.claude/memory/documents/reference/ECHO-ARCHITECTURE.md`

---

#### **If OPERATION = write:**

**1. Use Read tool:** `.claude/ESMC-Chaos/components/6f96de3d.js`
   - **Full file read (NO chunking)** - Pre-optimized for document creation

**2. Execute WRITE Protocol:**

   **a) Create document with metadata** - Use DocumentWriting.writeDocument()
   **b) Save to `.claude/memory/documents/`**
   **c) Update document index**
   **d) Display confirmation**

**3. Continue.** WRITE is not terminal.

---

#### **If OPERATION = cl:**

**1. Use Bash tool:** `node .claude/ESMC-Chaos/components/7634f19b.js <command>`
   - CLI wrapper (500 tokens vs 4,903 tokens direct read = 90% savings)

**2. Execute CL Protocol:**

   **a) Find or create CL file**
   **b) Insert CL tag at specified line**
   **c) Update topic index**
   **d) Display confirmation**

**3. Continue.** CL is not terminal.

---

#### **If OPERATION = gc:**

**1. Use Bash tool:** `node .claude/ESMC-Chaos/components/0d638f9b.js <command>`
   - CLI wrapper (500 tokens vs 5,056 tokens direct read = 89% savings)

**2. Execute GC Protocol:**

   **a) Scan for duplicate/obsolete sessions**
   **b) Archive old entries**
   **c) Rebuild indices**
   **d) Display cleanup summary**

**3. Continue.** GC is not terminal.

---

#### **If OPERATION = audit:**

**1. Use Read tool:** `.claude/ESMC-Chaos/components/bea9aca9.js`
   - **Full file read (NO chunking)** - Pre-optimized for execution logging

**2. Execute AUDIT Protocol:**

   **a) Log execution metadata**
   **b) Write to audit trail**
   **c) Display confirmation**

**3. Continue.** AUDIT is not terminal.

---

## üìö EXTERNAL DOCUMENTATION

**Component router details, token savings analysis, and ATLAS architecture extracted to:**

- `.claude/memory/documents/reference/AEGIS-SEED-GUIDE.md` (SEED protocol)
- `.claude/memory/documents/reference/ECHO-ARCHITECTURE.md` (Legacy ECHO)
- `.claude/memory/documents/reference/ATLAS-ARCHITECTURE.md` (Memory retrieval)
- `.claude/memory/documents/reference/SYSTEM-ARCHITECTURE.md` (System overview)
- `.claude/memory/documents/reference/ORACLE-PROTOCOL.md` (Code review protocol)

---

**END OF REFERENCE - Execute AEGIS operation via Component Router**


<!--
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë ESMC SDK v4.1 ¬© 2025 Abelitie Designs Malaysia    ‚ïë
‚ïë Build: 2025-11-20 | https://esmc-sdk.com                    ‚ïë
‚ïë                                                               ‚ïë
‚ïë ‚ö†Ô∏è  PROPRIETARY SOFTWARE - Licensed, Not Sold                 ‚ïë
‚ïë                                                               ‚ïë
‚ïë ESMC is a commercial AI-powered development framework.        ‚ïë
‚ïë Unauthorized use, copying, or distribution is strictly        ‚ïë
‚ïë prohibited and will be prosecuted to the fullest extent       ‚ïë
‚ïë of applicable law.                                            ‚ïë
‚ïë                                                               ‚ïë
‚ïë If you obtained this without purchase or valid license:       ‚ïë
‚ïë ‚Üí Report to: security@esmc-sdk.com                            ‚ïë
‚ïë ‚Üí Purchase at: https://esmc-sdk.com                           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->